"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5196],{21934:(e,t,r)=>{r.d(t,{U:()=>a});var s=r(74228);let a={getAllEmployees:async()=>(await s.A.get("/employee/")).data,getEmployeeByWallet:async e=>(await s.A.get("/employee/".concat(e))).data,addEmployee:async e=>(await s.A.post("/employee/add",e)).data,getEmployeePayroll:async e=>(await s.A.get("/employee/payroll/".concat(e))).data,bulkUploadEmployees:async e=>(await s.A.post("/employee/bulk-upload",e,{headers:{"Content-Type":"multipart/form-data"}})).data,updateEmployee:async(e,t)=>(await s.A.patch("/employee/update/".concat(e),t)).data,deleteEmployee:async e=>(await s.A.delete("/employee/delete/".concat(e))).data}},35196:(e,t,r)=>{r.d(t,{AuthProvider:()=>g,O:()=>h,A:()=>p});var s=r(95155),a=r(12115),o=r(35695),l=r(31530),i=r(64767);r(21934),r(94860),r(74228),r(51931);var n=r(10351);let d=e=>{let{t,icon:r,title:a,message:o,borderColor:i}=e;return(0,s.jsxs)("div",{className:"".concat(t.visible?"animate-enter":"animate-leave"," max-w-md w-full bg-white shadow-lg rounded-lg pointer-events-auto flex ring-1 ring-black ring-opacity-5 border-l-4 ").concat(i),children:[(0,s.jsx)("div",{className:"flex-1 w-0 p-4",children:(0,s.jsxs)("div",{className:"flex items-start",children:[(0,s.jsx)("div",{className:"flex-shrink-0 pt-0.5",children:r}),(0,s.jsxs)("div",{className:"ml-3 flex-1",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900",children:a}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:o})]})]})}),(0,s.jsx)("div",{className:"flex border-l border-gray-200",children:(0,s.jsx)("button",{onClick:()=>l.oR.dismiss(t.id),className:"w-full border border-transparent rounded-none rounded-r-lg p-4 flex items-center justify-center text-sm font-medium text-indigo-600 hover:text-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:"Close"})})]})},c=["/","/login","/register","/forgot-password"],u=["/pages/payroll"],m=(0,a.createContext)(void 0),g=e=>{let{children:t}=e,[r,g]=(0,a.useState)(null),[p,h]=(0,a.useState)(!0),[x,y]=(0,a.useState)(null),[f,w]=(0,a.useState)(!1),v=(0,o.useRouter)(),b=(0,o.usePathname)(),j=e=>{try{let t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(atob(t).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(r)}catch(e){return console.error("Error parsing token:",e),null}},A=e=>!e||Date.now()/1e3>e,N=()=>{localStorage.removeItem("authToken"),localStorage.removeItem("user"),g(null),y(null),v.replace("/")},S=async e=>{try{h(!0);let t=await i.Z.login(e);if(null==t?void 0:t.token){let e=j(t.token);if(e)y(e.exp),localStorage.setItem("authToken",t.token);else throw Error("Invalid token structure received")}else throw Error("No authentication token received");if(null==t?void 0:t.safeUser)return g(t.safeUser),localStorage.setItem("user",JSON.stringify(t.safeUser)),l.oR.custom(e=>(0,s.jsx)(d,{t:e,icon:(0,s.jsx)(n.A3x,{className:"h-6 w-6 text-green-500"}),title:"Login Successful",message:"Welcome back, ".concat(t.safeUser.email,"!"),borderColor:"border-green-500"})),t.safeUser.isAdmin?v.push("/pages/payroll"):v.push("/pages/employee"),{success:!0};throw Error("Invalid user data received")}catch(a){var t,r;console.error("Login error:",a);let e=(null==(r=a.response)||null==(t=r.data)?void 0:t.message)||"Failed to login. Please try again.";return l.oR.custom(t=>(0,s.jsx)(d,{t:t,icon:(0,s.jsx)(n.q_G,{className:"h-6 w-6 text-red-500"}),title:"Login Failed",message:e,borderColor:"border-red-500"})),{success:!1,error:e}}finally{h(!1)}},k=async e=>{try{return h(!0),await i.Z.register(e),l.oR.custom(e=>(0,s.jsx)(d,{t:e,icon:(0,s.jsx)(n.vq3,{className:"h-6 w-6 text-green-500"}),title:"Registration Successful",message:"Account created. Logging you in...",borderColor:"border-green-500"}),{duration:2e3}),await S({email:e.email,password:e.password})}catch(a){var t,r;console.error("Registration error:",a);let e=(null==(r=a.response)||null==(t=r.data)?void 0:t.message)||"Failed to register. Please try again.";return l.oR.custom(t=>(0,s.jsx)(d,{t:t,icon:(0,s.jsx)(n.q_G,{className:"h-6 w-6 text-red-500"}),title:"Registration Failed",message:e,borderColor:"border-red-500"})),{success:!1,error:e}}finally{h(!1)}};(0,a.useEffect)(()=>{if(!x)return;let e=x-Date.now()/1e3,t=null,a=null;return e>300?(t=setTimeout(()=>{l.oR.custom(e=>(0,s.jsx)(d,{t:e,icon:(0,s.jsx)(n.eHT,{className:"h-6 w-6 text-yellow-500"}),title:"Session Warning",message:"Your session will expire in 5 minutes.",borderColor:"border-yellow-500"}),{duration:1e4})},(e-300)*1e3),a=setTimeout(()=>{N(),l.oR.custom(e=>(0,s.jsx)(d,{t:e,icon:(0,s.jsx)(n.Ohp,{className:"h-6 w-6 text-red-500"}),title:"Session Expired",message:"Your session has ended. Please login again.",borderColor:"border-red-500"}))},1e3*e)):e>0?a=setTimeout(()=>{N(),l.oR.custom(e=>(0,s.jsx)(d,{t:e,icon:(0,s.jsx)(n.Ohp,{className:"h-6 w-6 text-red-500"}),title:"Session Expired",message:"Your session has ended. Please login again.",borderColor:"border-red-500"}))},1e3*e):r&&(N(),l.oR.custom(e=>(0,s.jsx)(d,{t:e,icon:(0,s.jsx)(n.Ohp,{className:"h-6 w-6 text-red-500"}),title:"Session Expired",message:"Your session has ended. Please login again.",borderColor:"border-red-500"}))),()=>{t&&clearTimeout(t),a&&clearTimeout(a)}},[x,r]);let E=async()=>{let e=localStorage.getItem("authToken"),t=localStorage.getItem("user");if(!e||!t)return g(null),c.includes(b||"")||"/"===b||v.replace("/"),h(!1),w(!0),!1;try{let r=j(e);if(!r||A(r.exp))throw Error("Token expired");y(r.exp);let a=JSON.parse(t);if(g(a),u.some(e=>null==b?void 0:b.startsWith(e))&&!a.isAdmin)return l.oR.custom(e=>(0,s.jsx)(d,{t:e,icon:(0,s.jsx)(n.del,{className:"h-6 w-6 text-red-500"}),title:"Access Denied",message:"You don't have permission to access this page.",borderColor:"border-red-500"})),v.replace("/"),h(!1),w(!0),!1;return h(!1),w(!0),!0}catch(e){return l.oR.custom(e=>(0,s.jsx)(d,{t:e,icon:(0,s.jsx)(n.Ohp,{className:"h-6 w-6 text-red-500"}),title:"Session Expired",message:"Your session is invalid or has ended. Please login again.",borderColor:"border-red-500"})),N(),h(!1),w(!0),!1}};return(0,a.useEffect)(()=>{E()},[]),(0,a.useEffect)(()=>{if(f){let e=localStorage.getItem("authToken"),t=localStorage.getItem("user");if(!e||!t){c.includes(b||"")||"/"===b||v.replace("/pages/auth");return}r&&u.some(e=>null==b?void 0:b.startsWith(e))&&!r.isAdmin&&(l.oR.custom(e=>(0,s.jsx)(d,{t:e,icon:(0,s.jsx)(n.del,{className:"h-6 w-6 text-red-500"}),title:"Access Denied",message:"You don't have permission to access this page.",borderColor:"border-red-500"})),v.replace("/pages/auth"))}},[b,f,r]),(0,a.useEffect)(()=>{let e=setInterval(async()=>{try{let e=await i.Z.ping();e?console.log("Ping successful:",e):console.log("Ping failed")}catch(e){console.log("Ping error:",e)}},45e3);return()=>clearInterval(e)},[]),(0,s.jsx)(m.Provider,{value:{user:r,isAuthenticated:!!r,isLoading:p,isAdmin:null==r?void 0:r.isAdmin,logout:N,login:S,register:k},children:t})},p=()=>{let e=(0,a.useContext)(m);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},h=e=>{let{route:t,children:r,requireAdmin:i=!1}=e,{user:c,isLoading:u,isAdmin:m}=p(),g=(0,o.useRouter)(),[h,x]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{if(!u){if(!c)return void g.replace("/pages/auth");if(i&&!c.isAdmin){l.oR.custom(e=>(0,s.jsx)(d,{t:e,icon:(0,s.jsx)(n.F5$,{className:"h-6 w-6 text-red-500"}),title:"Admin Required",message:"You need administrator privileges for this area.",borderColor:"border-red-500"})),g.replace("/pages/auth");return}x(!0)}},[c,u,i,m,g,t]),u)?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen min-w-screen",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):h?(0,s.jsx)(s.Fragment,{children:r}):null}},46520:(e,t,r)=>{r.d(t,{p:()=>s});let s="https://payzoll-server.onrender.com"},51931:(e,t,r)=>{r.d(t,{A:()=>a});var s=r(74228);let a={subscribeToNewsletter:async e=>{try{return(await s.A.post("/email/subscribe",e)).data}catch(e){return console.error("Newsletter subscription error:",e),{success:!1,message:e.message||"Failed to subscribe to newsletter",error:e.toString()}}},joinWaitlist:async e=>{try{return(await s.A.post("/email/waitlist",e)).data}catch(e){return console.error("Waitlist registration error:",e),{success:!1,message:e.message||"Failed to join waitlist",error:e.toString()}}}}},64767:(e,t,r)=>{r.d(t,{Z:()=>a});var s=r(74228);let a={login:async e=>{var t,r;let a=await s.A.post("/auth/login",e);return(null==(t=a.data)?void 0:t.token)&&localStorage.setItem("authToken",a.data.token),(null==(r=a.data)?void 0:r.safeUser)&&localStorage.setItem("user",JSON.stringify(a.data.safeUser)),console.log("Login response:",a.data),a.data},register:async e=>(await s.A.post("/auth/register",e)).data,forgotPassword:async e=>(await s.A.post("/auth/forgotPassword",{email:e})).data,ping:async()=>(await s.A.post("/auth/ping")).data}},74228:(e,t,r)=>{r.d(t,{A:()=>l});var s=r(23464);let a=r(46520).p,o=s.A.create({baseURL:a,headers:{"Content-Type":"application/json"}});o.interceptors.request.use(e=>{let t=localStorage.getItem("authToken");return t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),o.interceptors.response.use(e=>e,e=>{let{response:t}=e;return(null==t?void 0:t.status)===401&&(localStorage.removeItem("authToken"),window.location.href="/"),Promise.reject({status:null==t?void 0:t.status,message:"object"==typeof(null==t?void 0:t.data)&&(null==t?void 0:t.data)&&"message"in t.data?t.data.message:"An unexpected error occurred",data:null==t?void 0:t.data,originalError:e})});let l=o},94860:(e,t,r)=>{r.d(t,{U:()=>a});var s=r(74228);let a={addPayroll:async e=>(await s.A.post("/payroll/add",e)).data,getPayrollHistory:async()=>(await s.A.get("/payroll/history")).data}}}]);